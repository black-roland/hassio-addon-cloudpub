# Changelog

## 1.9.8

![Скачиваний в неделю](https://img.shields.io/badge/dynamic/json?url=https%3A%2F%2Fmansmarthome.info%2Fgithub%2Fblack-roland%2Fhassio-addon-cloudpub%2Ftraffic.json&query=weekly.uniques&suffix=%20%D0%B2%20%D0%BD%D0%B5%D0%B4%D0%B5%D0%BB%D1%8E&style=flat-square&label=%D1%81%D0%BA%D0%B0%D1%87%D0%B8%D0%B2%D0%B0%D0%BD%D0%B8%D0%B9&color=brightgreen&cacheSeconds=86400)
[![Поддержать обновления](https://img.shields.io/badge/%D0%9F%D0%BE%D0%B4%D0%B4%D0%B5%D1%80%D0%B6%D0%B0%D1%82%D1%8C_%D0%BE%D0%B1%D0%BD%D0%BE%D0%B2%D0%BB%D0%B5%D0%BD%D0%B8%D1%8F-Boosty-FF6B6B?style=flat-square&logo=boosty)](https://boosty.to/mansmarthome/about?utm_source=github&utm_medium=referral&utm_campaign=cloudpub)
[![Разовый донат](https://img.shields.io/badge/%E2%98%95_%D0%9E%D1%82%D0%B1%D0%BB%D0%B0%D0%B3%D0%BE%D0%B4%D0%B0%D1%80%D0%B8%D1%82%D1%8C-8A2BE2?style=flat-square)](https://mansmarthome.info/donate/?utm_source=github&utm_medium=referral&utm_campaign=cloudpub#%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D0%B0-%D0%B1%D1%8B%D1%81%D1%82%D1%80%D1%8B%D1%85-%D0%BF%D0%BB%D0%B0%D1%82%D0%B5%D0%B6%D0%B5%D0%B9)

### Исправлено

- Регрессия с повторной регистрацией сервисов:
  Изменение формата вывода команды clo ls в клиенте CloudPub привело к тому, что аддон ошибочно пытался повторно регистрировать уже зарегистрированные сервисы. Теперь аддон корректно проверяет статус сервисов перед регистрацией.
- Исправлена работа механизма удаления сервисов — теперь используется обновленный синтаксис команды unpublish (клиент больше не требует параметр `--remove`).

## 1.9.7

### Изменено

- Клиент CloudPub [обновлён до версии **2.3.1**](https://cloudpub.ru/docs/changelog).

## 1.9.6

### Изменено

- Клиент CloudPub [обновлён до версии **2.3.0**](https://cloudpub.ru/docs/changelog).

### Исправлено

- Ошибка при запуске аддона, если токен начинается с `-` ([#22](https://github.com/black-roland/hassio-addon-cloudpub/issues/22)).

## 1.9.5

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.4**](https://cloudpub.ru/docs/changelog).

## 1.9.4

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.2**](https://cloudpub.ru/docs/changelog).

## 1.9.3

На главной странице CloudPub появилось предупреждение:

> ВНИМАНИЕ: Версии от 2.0.0 до 2.2.0 могут иметь проблемы со стабильностью работы. Настоятельно рекомендуем обновиться до версии 2.2.1.

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.1**](https://cloudpub.ru/docs/changelog).

## 1.9.2

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.0**](https://cloudpub.ru/docs/changelog).

## 1.9.1

### Изменено

- Клиент CloudPub [обновлён до версии **2.1.1**](https://cloudpub.ru/docs/changelog).

## 1.9.0

### Изменено

- Клиент CloudPub [обновлён до версии **2.1.0**](https://cloudpub.ru/docs/changelog).

### Исправлено

- Перезапуск при проблемах с интернет-подключением теперь корректно работает с последней версией клиента.
- Добавлены паузы при регистрации большого количества сервисов одновременно, что потенциально позволяет избежать ошибок типа «Канал закрыт, так как подключился новый агент», возникающих при регистрации трех и более сервисов.

## 1.8.3

### Изменено

- Клиент CloudPub [обновлён до версии **2.0.0**](https://cloudpub.ru/docs/changelog#200-16-%D0%B8%D1%8E%D0%BD%D1%8F-2025).
  _Примечание: В журнале возможно появление ошибок `Data channel N closed by server`, которые не влияют на работу клиента._

## 1.8.2

### Изменено

- Клиент CloudPub [обновлён до версии **1.7.0**](https://cloudpub.ru/docs/changelog#170-29-%D0%BC%D0%B0%D1%8F-2025).

## 1.8.1

### Изменено

- Клиент CloudPub [обновлён до версии **1.6.0**](https://cloudpub.ru/docs/changelog#160-08-%D0%BC%D0%B0%D1%8F-2025).
- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.3**.

## 1.8.0

### Исправлено

- Watchdog возвращён обратно, так как проблема с восстановлением соединения ([issue #3](https://github.com/ermakus/cloudpub/issues/3)) видимо не была полностью исправлена в клиенте.

### Изменено

- Клиент CloudPub обновлён до версии **1.5.198**.
- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.2**.

## 1.7.1

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.197**](https://cloudpub.ru/docs/changelog#15197-13-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

## 1.7.0

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.190**](https://cloudpub.ru/docs/changelog#15190-09-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

### Удалено

- Удалён временный «костыль» для корректной обработки exit code клиента — [исправлено в CloudPub 1.5.190](https://github.com/ermakus/cloudpub/issues/2#event-17187071334).
- Watchdog, добавленный в версии 1.4.0, больше не требуется — клиент теперь [корректно восстанавливает соединение с сервером](https://github.com/ermakus/cloudpub/issues/3#event-17187073714).

## 1.6.1

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.171**](https://cloudpub.ru/docs/changelog#15171-08-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

## 1.6.0

### Изменено

- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.1**.
- Клиент CloudPub обновлён до версии **1.5.0**.
- Актуализирован скрипт для удаления сервисов из CloudPub при их удалении из конфигурации аддона.

### Исправлено

- Добавлена валидация токена перед запуском клиента CloudPub.
- При появлении в логах ошибки «Control channel error» происходит корректное завершение сервиса, [даже если клиент CloudPub вернул нулевой код (exit code)](https://github.com/ermakus/cloudpub/issues/2). Ранее таким образом обрабатывались только ошибки аутентификации.

## 1.5.0

### Добавлено

- Возможность вставлять полную команду с токеном вида `./clo set token <токен>` прямо в поле токена. Аддон сам извлечем нужное значение, упрощая процесс первоначальной настройки для новых пользователей.

### Изменено

- Аддон переведён в разряд стабильных и теперь доступен всем пользователям, даже если у них не включён расширенный режим в профиле.

## 1.4.1

### Добавлено

- Добавлена поддержка `armhf` и `i386`.

## 1.4.0

### Добавлено

- Добавлен watchdog, который автоматически перезапускает клиент CloudPub в случае ошибки инициализации data channel. Ошибка `WebSocket protocol error: Connection reset without closing handshake` может возникать при обрыве интернет-соединения ([issue в upstream](https://github.com/ermakus/cloudpub/issues/3)).

## 1.3.0

### Удалено

- Удалён AppArmor из-за невозможности отладки на всех устройствах (на некоторых приставках AppArmor всё равно не заработал).

## 1.2.0

### Исправлено

- При удалении сервиса из конфигурации аддона он теперь корректно удаляется из CloudPub.

## 1.1.4

### Исправлено

- Исправлен запуск на одноплатных компьютерах и ТВ-приставках с архитектурой `aarch64`: добавлены необходимые разрешения в профиль AppArmor.
- Для архитектуры `aarch64` вновь используется 64-битная версия клиента.

### Изменено

- Скрыты избыточные логи при выполнении команды `clo register`.

## 1.1.3

### Добавлено

- Реализован настраиваемый уровень логирования. Теперь можно выбирать между уровнями: `error`, `warn`, `info`, `debug`.

### Исправлено

- Для архитектуры `aarch64` теперь применяется другая версия клиента, что решает проблему запуска на одноплатных компьютерах и ТВ-приставках.

## 1.1.2

### Исправлено

- В профиль AppArmor добавлены сетевые разрешения, устраняющие ошибку «Failed to connect to supervisor port 80».

## 1.1.1

### Исправлено

- Улучшена обработка ошибок при запуске клиента.
- Добавлена корректная обработка ошибки «Неверный ключ API».

## 1.1.0

### Добавлено

- Добавлен профиль AppArmor для повышения безопасности аддона. Он ограничивает доступ к файловой системе и сетевым ресурсам, предотвращая возможные уязвимости.
- Добавлены значок и логотип для улучшения визуального представления аддона в интерфейсе Home Assistant.

### Изменено

- Документация перенесена в отдельный файл `DOCS.md` для упрощения её сопровождения и чтения.

## 1.0.0

### Первая стабильная версия

- Удаленный доступ к Home Assistant за NAT.
- Поддержка туннелирования HTTP, HTTPS, TCP, UDP и RTSP.
- Простая настройка.
