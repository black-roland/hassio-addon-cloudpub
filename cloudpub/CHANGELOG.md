# Changelog

## [1.9.8] - 2025-08-01

### Исправлено

- Регрессия с повторной регистрацией сервисов:
   Изменение формата вывода команды clo ls в клиенте CloudPub привело к тому, что аддон ошибочно пытался повторно регистрировать уже зарегистрированные сервисы. Теперь аддон корректно проверяет статус сервисов перед регистрацией.
- Исправлена работа механизма удаления сервисов — теперь используется обновленный синтаксис команды unpublish (клиент больше не требует параметр `--remove`).

## [1.9.7] - 2025-08-01

### Изменено

- Клиент CloudPub [обновлён до версии **2.3.1**](https://cloudpub.ru/docs/changelog).

## [1.9.6] - 2025-07-28

### Исправлено

- Ошибка при запуске аддона, если токен начинается с `-` ([#22](https://github.com/black-roland/hassio-addon-cloudpub/issues/22)).

### Изменено

- Клиент CloudPub [обновлён до версии **2.3.0**](https://cloudpub.ru/docs/changelog).

## [1.9.5] - 2025-07-28

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.4**](https://cloudpub.ru/docs/changelog).

## [1.9.4] - 2025-07-17

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.2**](https://cloudpub.ru/docs/changelog).

## [1.9.3] - 2025-07-14

На главной странице CloudPub появилось предупреждение:

> ВНИМАНИЕ: Версии от 2.0.0 до 2.2.0 могут иметь проблемы со стабильностью работы. Настоятельно рекомендуем обновиться до версии 2.2.1.

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.1**](https://cloudpub.ru/docs/changelog).

## [1.9.2] - 2025-07-13

### Изменено

- Клиент CloudPub [обновлён до версии **2.2.0**](https://cloudpub.ru/docs/changelog).

## [1.9.1] - 2025-07-04

### Изменено

- Клиент CloudPub [обновлён до версии **2.1.1**](https://cloudpub.ru/docs/changelog).

## [1.9.0] - 2025-06-25

### Изменено

- Клиент CloudPub [обновлён до версии **2.1.0**](https://cloudpub.ru/docs/changelog).

### Исправлено

- Перезапуск при проблемах с интернет-подключением теперь корректно работает с последней версией клиента.
- Добавлены паузы при регистрации большого количества сервисов одновременно, что потенциально позволяет избежать ошибок типа «Канал закрыт, так как подключился новый агент», возникающих при регистрации трех и более сервисов.

## [1.8.3] - 2025-06-19

### Изменено

- Клиент CloudPub [обновлён до версии **2.0.0**](https://cloudpub.ru/docs/changelog#200-16-%D0%B8%D1%8E%D0%BD%D1%8F-2025).
   *Примечание: В журнале возможно появление ошибок `Data channel N closed by server`, которые не влияют на работу клиента.*

## [1.8.2] - 2025-06-04

### Изменено

- Клиент CloudPub [обновлён до версии **1.7.0**](https://cloudpub.ru/docs/changelog#170-29-%D0%BC%D0%B0%D1%8F-2025).

## [1.8.1] - 2025-05-19

### Изменено

- Клиент CloudPub [обновлён до версии **1.6.0**](https://cloudpub.ru/docs/changelog#160-08-%D0%BC%D0%B0%D1%8F-2025).
- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.3**.

## [1.8.0] - 2025-04-16

### Исправлено

- Watchdog возвращён обратно, так как проблема с восстановлением соединения ([issue #3](https://github.com/ermakus/cloudpub/issues/3)) видимо не была полностью исправлена в клиенте.

### Изменено

- Клиент CloudPub обновлён до версии **1.5.198**.
- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.2**.

## [1.7.1] - 2025-04-13

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.197**](https://cloudpub.ru/docs/changelog#15197-13-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

## [1.7.0] - 2025-04-10

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.190**](https://cloudpub.ru/docs/changelog#15190-09-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

### Удалено

- Удалён временный «костыль» для корректной обработки exit code клиента — [исправлено в CloudPub 1.5.190](https://github.com/ermakus/cloudpub/issues/2#event-17187071334).
- Watchdog, добавленный в версии 1.4.0, больше не требуется — клиент теперь [корректно восстанавливает соединение с сервером](https://github.com/ermakus/cloudpub/issues/3#event-17187073714).

## [1.6.1] - 2025-04-08

### Изменено

- Клиент CloudPub [обновлён до версии **1.5.171**](https://cloudpub.ru/docs/changelog#15171-08-%D0%B0%D0%BF%D1%80%D0%B5%D0%BB%D1%8F-2025).

## [1.6.0] - 2025-04-07

### Изменено

- Базовый Docker-образ (`ghcr.io/hassio-addons/debian-base`) обновлён до версии **7.8.1**.
- Клиент CloudPub обновлён до версии **1.5.0**.
- Актуализирован скрипт для удаления сервисов из CloudPub при их удалении из конфигурации аддона.

### Исправлено

- Добавлена валидация токена перед запуском клиента CloudPub.
- При появлении в логах ошибки «Control channel error» происходит корректное завершение сервиса, [даже если клиент CloudPub вернул нулевой код (exit code)](https://github.com/ermakus/cloudpub/issues/2). Ранее таким образом обрабатывались только ошибки аутентификации.

## [1.5.0] - 2025-03-26

### Добавлено

- Возможность вставлять полную команду с токеном вида `./clo set token <токен>` прямо в поле токена. Аддон сам извлечем нужное значение, упрощая процесс первоначальной настройки для новых пользователей.

### Изменено

- Аддон переведён в разряд стабильных и теперь доступен всем пользователям, даже если у них не включён расширенный режим в профиле.

## [1.4.1] - 2025-03-17

### Добавлено

- Добавлена поддержка `armhf` и `i386`.

## [1.4.0] - 2025-03-09

### Добавлено

- Добавлен watchdog, который автоматически перезапускает клиент CloudPub в случае ошибки инициализации data channel. Ошибка `WebSocket protocol error: Connection reset without closing handshake` может возникать при обрыве интернет-соединения ([issue в upstream](https://github.com/ermakus/cloudpub/issues/3)).

## [1.3.0] - 2025-03-08

### Удалено

- Удалён AppArmor из-за невозможности отладки на всех устройствах (на некоторых приставках AppArmor всё равно не заработал).

## [1.2.0] - 2025-03-08

### Исправлено

- При удалении сервиса из конфигурации аддона он теперь корректно удаляется из CloudPub.

## [1.1.4] - 2025-03-07

### Исправлено

- Исправлен запуск на одноплатных компьютерах и ТВ-приставках с архитектурой `aarch64`: добавлены необходимые разрешения в профиль AppArmor.
- Для архитектуры `aarch64` вновь используется 64-битная версия клиента.

### Изменено

- Скрыты избыточные логи при выполнении команды `clo register`.

## [1.1.3] - 2025-03-07

### Добавлено

- Реализован настраиваемый уровень логирования. Теперь можно выбирать между уровнями: `error`, `warn`, `info`, `debug`.

### Исправлено

- Для архитектуры `aarch64` теперь применяется другая версия клиента, что решает проблему запуска на одноплатных компьютерах и ТВ-приставках.

## [1.1.2] - 2025-03-07

### Исправлено

- В профиль AppArmor добавлены сетевые разрешения, устраняющие ошибку «Failed to connect to supervisor port 80».

## [1.1.1] - 2025-03-07

### Исправлено

- Улучшена обработка ошибок при запуске клиента.
- Добавлена корректная обработка ошибки «Неверный ключ API».

## [1.1.0] - 2025-03-07

### Добавлено

- Добавлен профиль AppArmor для повышения безопасности аддона. Он ограничивает доступ к файловой системе и сетевым ресурсам, предотвращая возможные уязвимости.
- Добавлены значок и логотип для улучшения визуального представления аддона в интерфейсе Home Assistant.

### Изменено

- Документация перенесена в отдельный файл `DOCS.md` для упрощения её сопровождения и чтения.

## [1.0.0] - 2025-03-06

### Первая стабильная версия

- Удаленный доступ к Home Assistant за NAT.
- Поддержка туннелирования HTTP, HTTPS, TCP, UDP и RTSP.
- Простая настройка.
